<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="description" content="this is a blog"><meta name="viewport" content="width=device-width, initial-scale=1"><title>UDP首部检验和 · gzmviavia</title><link rel="short icon" href="/favicon.ico"><!-- font--><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto Mono"><!-- icon--><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><!-- theme style--><link rel="stylesheet" href="/css/style.css"><!-- baidu analytics--><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?9e0cbea7d3319c6c94c71dfb93c151b8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><!-- google analytics--><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-74273646-1', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">gzmviavia</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">首页</a></li><li class="nav-link"><a href="/archives/" target="_self">归档</a></li><li class="nav-link"><a href="/categories/" target="_self">分类</a></li><li class="nav-link"><a href="/tags/" target="_self">标签</a></li><li class="nav-link"><a href="/about/" target="_self">关于</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">UDP首部检验和</h1><span class="post-time">2016年8月8日</span><div id="sidebar" class="post-sidebar"><h3 class="heading">目录</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#UDP首部检验和的计算规则"><span class="toc-text">UDP首部检验和的计算规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发送UDP数据报"><span class="toc-text">发送UDP数据报</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#抓取UDP数据报"><span class="toc-text">抓取UDP数据报</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#计算首部检验和"><span class="toc-text">计算首部检验和</span></a></li></ol></div><div class="post-content"><h2 id="UDP&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;&#x7684;&#x8BA1;&#x7B97;&#x89C4;&#x5219;"><a href="#UDP&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;&#x7684;&#x8BA1;&#x7B97;&#x89C4;&#x5219;" class="headerlink" title="UDP&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;&#x7684;&#x8BA1;&#x7B97;&#x89C4;&#x5219;"></a>UDP&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;&#x7684;&#x8BA1;&#x7B97;&#x89C4;&#x5219;</h2><blockquote>
<p>ARP&#x534F;&#x8BAE;&#xFF0C;IP&#x534F;&#x8BAE;&#x9996;&#x90E8;&#x7684;&#x68C0;&#x9A8C;&#x548C;&#x8BA1;&#x7B97;&#x65F6;&#x90FD;&#x662F;&#x5148;&#x5C06;<code>checksum</code>&#x5B57;&#x6BB5;&#x7F6E;&#x4E3A;0&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x9996;&#x90E8;&#x5B57;&#x6BB5;&#x8FDB;&#x884C;16&#x4F4D;&#x53CD;&#x7801;&#x6C42;&#x548C;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x8986;&#x76D6;&#x6570;&#x636E;&#x90E8;&#x5206;&#x3002;&#x800C;UDP&#x8BA1;&#x7B97;&#x68C0;&#x9A8C;&#x548C;&#x65F6;&#x4F1A;&#x5BF9;UDP&#x4F2A;&#x9996;&#x90E8;&#x3001;UDP&#x9996;&#x90E8;&#x3001;UDP&#x6570;&#x636E;&#x90E8;&#x5206;&#x90FD;&#x8FDB;&#x884C;16&#x4F4D;&#x53CD;&#x7801;&#x6C42;&#x548C;&#xFF0C;&#x7531;&#x4E8E;&#x6570;&#x636E;&#x90E8;&#x5206;&#x53EF;&#x80FD;&#x662F;&#x5947;&#x6570;&#x4F4D;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x6570;&#x636E;&#x90E8;&#x5206;&#x4E3A;&#x5947;&#x6570;&#x4F4D;&#x65F6;&#xFF0C;&#x4E3A;&#x4E86;&#x8BA1;&#x7B97;&#x68C0;&#x9A8C;&#x548C;&#x4F1A;&#x5728;&#x6700;&#x540E;&#x589E;&#x52A0;&#x586B;&#x5145;&#x5B57;&#x8282;0&#xFF0C;&#x8FD9;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x8BA1;&#x7B97;&#x68C0;&#x9A8C;&#x548C;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x88AB;&#x53D1;&#x9001;&#x3002;</p>
</blockquote>
<a id="more"></a>
<pre><code>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x52A0;&#x4E0A;&#x4F2A;&#x9996;&#x90E8;&#x7136;&#x540E;&#x8BA1;&#x7B97;&#x68C0;&#x9A8C;&#x548C;&#x5462;&#xFF1F;
</code></pre><p>&#x6240;&#x9700;&#x8981;&#x8BA1;&#x7B97;&#x68C0;&#x9A8C;&#x548C;&#x7684;&#x5B57;&#x6BB5;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x3002;</p>
<p><img src="/2016/08/08/udp-header-check-sum/udp_check_sum_header.png" alt="UDP&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;&#x5B57;&#x6BB5;"></p>
<h2 id="&#x53D1;&#x9001;UDP&#x6570;&#x636E;&#x62A5;"><a href="#&#x53D1;&#x9001;UDP&#x6570;&#x636E;&#x62A5;" class="headerlink" title="&#x53D1;&#x9001;UDP&#x6570;&#x636E;&#x62A5;"></a>&#x53D1;&#x9001;UDP&#x6570;&#x636E;&#x62A5;</h2><p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x53D1;&#x9001;&#x4E00;&#x4E2A;UDP&#x6570;&#x636E;&#x5305;&#xFF0C;ip&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x968F;&#x4FBF;&#x586B;&#xFF0C;&#x53EA;&#x8981;&#x4E0D;&#x586B;&#x672C;&#x5730;&#x5730;&#x5740;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x81EA;&#x5DF1;&#x5411;&#x81EA;&#x5DF1;&#x53D1;&#x7684;&#x6570;&#x636E;&#x662F;&#x4E0D;&#x4F1A;&#x7ECF;&#x8FC7;&#x7F51;&#x5361;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x6293;&#x4E0D;&#x5230;&#x5305;&#x3002;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python2.7</span></div><div class="line"><span class="comment">#coding:utf-8</span></div><div class="line"><span class="keyword">import</span> socket</div><div class="line"></div><div class="line">ip = <span class="string">&apos;12.34.56.78&apos;</span></div><div class="line">port = <span class="number">80</span></div><div class="line">addr = (ip, port)</div><div class="line"></div><div class="line">udp_sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</div><div class="line">udp_sock.sendto(<span class="string">&apos;dat&apos;</span>, addr) <span class="comment">#&#x7279;&#x610F;&#x53D1;&#x9001;&#x5947;&#x6570;&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x6570;&#x636E;</span></div></pre></td></tr></table></figure>
<h2 id="&#x6293;&#x53D6;UDP&#x6570;&#x636E;&#x62A5;"><a href="#&#x6293;&#x53D6;UDP&#x6570;&#x636E;&#x62A5;" class="headerlink" title="&#x6293;&#x53D6;UDP&#x6570;&#x636E;&#x62A5;"></a>&#x6293;&#x53D6;UDP&#x6570;&#x636E;&#x62A5;</h2><p>&#x4F7F;&#x7528;wireshark&#x6293;&#x5230;&#x8BE5;UDP&#x62A5;&#xFF0C;&#x5305;&#x7684;&#x5177;&#x4F53;&#x6570;&#x636E;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2016/08/08/udp-header-check-sum/UDP_packet.png" alt=""></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;UDP&#x7684;&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;&#x4E3A;<code>0x58dx</code></p>
<h2 id="&#x8BA1;&#x7B97;&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;"><a href="#&#x8BA1;&#x7B97;&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;" class="headerlink" title="&#x8BA1;&#x7B97;&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;"></a>&#x8BA1;&#x7B97;&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;</h2><p>&#x4E3A;&#x4E86;&#x9A8C;&#x8BC1;UDP&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x7801;&#x662F;&#x600E;&#x4E48;&#x8BA1;&#x7B97;&#x7684;&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x5BF9;&#x9996;&#x90E8;&#x68C0;&#x9A8C;&#x548C;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">check_sum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">short</span> *arr, <span class="keyword">int</span> n)</span></span>{</div><div class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; ++i){</div><div class="line">		arr[i] = ~arr[i];</div><div class="line">		sum += arr[i];</div><div class="line">		sum = (sum&gt;&gt;<span class="number">16</span>) + (sum&amp;<span class="number">0xffff</span>);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> sum;</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">{</div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">short</span> arr[<span class="number">100</span>];</div><div class="line">	arr[<span class="number">0</span>] = <span class="number">0xc8d5</span>; <span class="comment">//&#x6E90;&#x7AEF;&#x53E3;</span></div><div class="line">	arr[<span class="number">1</span>] = <span class="number">0x0050</span>; <span class="comment">//&#x76EE;&#x7684;&#x7AEF;&#x53E3;</span></div><div class="line">	arr[<span class="number">2</span>] = <span class="number">0x000b</span>; <span class="comment">//udp&#x957F;&#x5EA6;&#xFF0C;8&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x9996;&#x90E8; + 3&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x6570;&#x636E;</span></div><div class="line">	arr[<span class="number">3</span>] = <span class="number">0x0000</span>; <span class="comment">//checksum</span></div><div class="line">	arr[<span class="number">4</span>] = <span class="number">0x6461</span>; <span class="comment">//&#x6570;&#x636E;&#x90E8;&#x5206;</span></div><div class="line">	arr[<span class="number">5</span>] = <span class="number">0x7400</span>; <span class="comment">//&#x5728;&#x6700;&#x540E;&#x589E;&#x52A0;&#x586B;&#x5145;&#x5B57;&#x8282;0</span></div><div class="line"></div><div class="line">	<span class="comment">//&#x4F2A;&#x9996;&#x90E8;</span></div><div class="line">	arr[<span class="number">6</span>] = <span class="number">0xc0a8</span>; <span class="comment">//&#x6E90;ip</span></div><div class="line">	arr[<span class="number">7</span>] = <span class="number">0x0064</span>;</div><div class="line">	arr[<span class="number">8</span>] = <span class="number">0x0c22</span>; <span class="comment">//&#x76EE;&#x7684;ip</span></div><div class="line">	arr[<span class="number">9</span>] = <span class="number">0x384e</span>;</div><div class="line">	arr[<span class="number">10</span>] = <span class="number">0x0011</span>; <span class="comment">// 0 + 8&#x4F4D;&#x534F;&#x8BAE;</span></div><div class="line">	arr[<span class="number">11</span>] = <span class="number">0x000b</span>; <span class="comment">//udp&#x957F;&#x5EA6;</span></div><div class="line">	<span class="keyword">int</span> n = <span class="number">12</span>;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%x\n&quot;</span>,check_sum(arr, n));</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>&#x8FD0;&#x884C;&#x8BE5;&#x4EE3;&#x7801;&#x540E;&#xFF0C;&#x679C;&#x7136;&#x53D1;&#x73B0;&#x68C0;&#x9A8C;&#x548C;&#x662F;<code>0x58d4</code></p>
<p>&#x6CE8;&#xFF1A;&#x4F7F;&#x7528;Python&#x53D1;&#x9001;UDP&#x662F;&#x56E0;&#x4E3A;Python&#x53D1;&#x9001;&#x6570;&#x636E;&#x62A5;&#x7B80;&#x5355;&#xFF0C;&#x4F7F;&#x7528;C++&#x8BA1;&#x7B97;&#x68C0;&#x9A8C;&#x548C;&#x662F;&#x56E0;&#x4E3A;C++&#x4F4D;&#x8FD0;&#x7B97;&#x65B9;&#x4FBF;&#xFF0C;Python&#x4F4D;&#x8FD0;&#x7B97;&#x8FD8;&#x9700;&#x8981;&#x7528;&#x5230;struct&#x5305;&#xFF0C;&#x592A;&#x9EBB;&#x70E6;&#x4E86;&#x3002;</p>
</div></article><div class="tags"><a href="/tags/运输层/">运输层</a><a href="/tags/UDP/">UDP</a></div><div class="paginator"><a href="/2016/08/09/user-datagram-protocol/" class="prev"><i class="iconfont icon-left"></i><span> 上一页</span></a><a href="/2016/08/07/backup-hexo/" class="next"><span>下一页</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">(function() {
var d = document, s = d.createElement('script');

s.src = '//ahonn.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script></section><footer><div class="copyright"><p>&copy;2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">gzmviavia</span></p><p class="theme">Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p></div><label id="back2top"><i class="iconfont icon-up"></i></label></footer></div></body><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></html>